let e,n;await window.interpretate.shared.Marked.load(),e=window.interpretate.shared.Marked.default,n=window.interpretate.shared.Marked.Renderer;const t=new n,o=t.link;let r;t.link=(e,n,r)=>{const a=e.startsWith(`${location.protocol}//${location.hostname}`),l=o.call(t,e,n,r);return a?l:l.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')};const a=window.SupportedCells.codemirror.context;await window.interpretate.shared.katex.load(),r=window.interpretate.shared.katex.default;const l={transaction:(e,n,t,o)=>{if(console.log(n.dom.ocellref),n.dom.ocellref){const e=n.dom.ocellref.origin.channel;server._emitt(e,`<|"Channel"->"${t}", "Length"->${o}, "CellType"->"md"|>`,'Forwarded["CM:PasteEvent"]')}},file:(e,n,t,o,r)=>{console.log(n.dom.ocellref),n.dom.ocellref&&server.emitt(t,`<|"Data"->"${r}", "Name"->"${o}"|>`,"File")}},c={transaction:(e,n,t,o)=>{if(console.log(n.dom.ocellref),n.dom.ocellref){const e=n.dom.ocellref.origin.channel;server._emitt(e,`<|"Channel"->"${t}", "Length"->${o}, "CellType"->"md"|>`,'Forwarded["CM:DropEvent"]')}},file:(e,n,t,o,r)=>{console.log(n.dom.ocellref),n.dom.ocellref&&server.emitt(t,`<|"Data"->"${r}", "Name"->"${o}"|>`,"File")}};function i(e){return{name:"frontendObject",level:"inline",start:e=>e.indexOf("FrontEndExecutable["),tokenizer(e,n){const t=e.match(/^FrontEndExecutable\[+([^\[\n]+?)\]+/);if(t)return{type:"frontendObject",raw:t[0],text:t[1].trim()}},renderer(n,t){console.warn("frontendObject");const o={uid:n.text,elementId:"femarkdown-"+uuidv4()};return e.buffer.push(o),console.warn(this),`<div class="markdown-feobject" id="${o.elementId}"></div>`}}}const s={throwOnError:!1};window.SupportedLanguages.push({check:e=>null!=e[0].match(/\w*\.(md)$/),plugins:[a.markdown(),a.DropPasteHandlers(c,l)],name:a.markdownLanguage.name}),window.SupportedCells.markdown={view:class{origin={};feObjects=[];envs=[];dispose(){console.warn("Markdown cell dispose...");for(const e of this.envs)for(const n of Object.values(e.global.stack))console.log("dispose"),n.dispose()}constructor(n,o){console.log("marked data:::"),console.log(o);const a=this;var l,c;return new e({async:!0,renderer:t,extensions:[(l=s,{name:"inlineKatex",level:"inline",start:e=>e.indexOf("$"),tokenizer(e,n){const t=e.match(/^\$+([^$\n]+?)\$+/);if(t)return{type:"inlineKatex",raw:t[0],text:t[1].trim()}},renderer:e=>(console.warn("inlineKatex"),r.renderToString(e.text.replaceAll("\\\\","\\"),l))}),{name:"mark",level:"inline",start:e=>e.indexOf("=="),tokenizer(e,n){const t=e.match(/^==+([^=\n]+?)==+/);if(t)return{type:"mark",raw:t[0],text:t[1].trim()}},renderer:e=>(console.warn("mark"),"<mark>"+e.text+"</mark>")},{name:"blockKatex",level:"block",start:e=>e.indexOf("\n$$"),tokenizer(e,n){const t=e.match(/^\$\$\n([^$]+?)\n\$\$/);if(t)return{type:"blockKatex",raw:t[0],text:t[1].trim()}},renderer:e=>(console.warn("blockKatex"),`<p style="padding-top: 1em; padding-bottom: 1em;">${r.renderToString(e.text.replaceAll("\\\\","\\"),{displayMode:!0})}</p>`)},i({buffer:a.feObjects})]}).parse((c=o,c.replace(/\\:[\da-f]{4}/gi,(function(e){return String.fromCharCode(parseInt(e.replace(/\\:/g,""),16))})))).then((e=>{n.element.innerHTML=e,a.feObjects.forEach((async e=>{var n={call:Date.now()+Math.floor(10009*Math.random())};console.warn("loading executable on a markdown field..."),console.log(e.uid);let t,o={global:n,element:document.getElementById(e.elementId)};console.log("Marked: creating an object"),console.log("forntend executable"),console.log("check cache"),t=ObjectHashMap[e.uid]?ObjectHashMap[e.uid]:new ObjectStorage(e.uid),console.log(t);const r=o,l=await t.get(),c=new ExecutableObject("marked-static-"+uuidv4(),r,l,!0);c.assignScope(r),t.assign(c),c.execute(),a.envs.push(o)}))})),n.element.classList.add("markdown","margin-bottom-fix"),this}}};
